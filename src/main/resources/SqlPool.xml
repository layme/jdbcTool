<?xml version="1.0" encoding="UTF-8" ?>
<sqls>
    <groups>
        <group id="backup">
            <sql>
                insert into backup_data_user.fa_fmgk_gkajztjk
                select jk.FA_FMGK_GGAJZTJK_ID,
                jk.SHENQINGH,
                jk.SHENQINGR,
                jk.DAOQIR,
                jk.PCTBJ,
                jk.ZUIXIAOYXQR,
                jk.TIQIANGKSXR,
                jk.CANSHENHGFWR,
                jk.GONGGAOZT,
                jk.YUGUGGR,
                jk.GONGGAOR,
                jk.ZHUFENLEIH,
                jk.JINRUJYCSJ,
                jk.JIAOYANWCSJ,
                jk.JIAOYANWCBJ,
                jk.JINRUGGCSJ,
                jk.GONGGAOWCSJ,
                jk.GONGGAOWCBJ,
                jk.FENLEIWCSJ,
                jk.FENLEIWCBJ,
                jk.CHUSHENYXM,
                jk.CHUSHENYBM,
                jk.REGNAME,
                jk.REGTIME,
                jk.MODNAME,
                jk.MODTIME,
                'rhy' || to_char(sysdate,'yyyymmdd')
                from fa_fmgk_gkajztjk jk
                where jk.shenqingh in (?)
            </sql>
            <sql>
                insert into backup_data_user.fa_fmgk_cbjyb_2
                SELECT jy.*,'rhy'||to_char(sysdate,'yyyymmdd') FROM fa_fmgk_cbjyb_2 jy where jy.shenqingh in (?)
            </sql>
            <sql>
                nsert into backup_data_user.fa_fmgk_gkqrb
                select qr.*,'rhy' || to_char(sysdate,'yyyymmdd') from fa_fmgk_gkqrb qr where qr.shenqingh in (?)
            </sql>
            <sql>
                insert into backup_data_user.fa_fmgk_jdb_ls
                select jd.*,'rhy' || to_char(sysdate,'yyyymmdd') from fa_fmgk_jdb_ls jd where jd.shenqingh in (?)
            </sql>
            <sql>
                insert into backup_data_user.gg_zlx_gkgg
                select t.RID,
                t.SHENQINGH,
                t.GONGKAIGGLX,
                t.JUANQIH,
                t.GONGGAOH,
                t.GONGGAOR,
                t.GONGGAOWCBJ,
                t.REGNAME,
                t.REGTIME,
                t.MODNAME,
                t.MODTIME,
                'rhy' || to_char(sysdate,'yyyymmdd')
                from gg_zlx_gkgg t
                where t.gongkaigglx = '1601'
                --and t.gonggaor = '20161019'
                and t.shenqingh in (?)
            </sql>
            <sql>
                insert into backup_data_user.gk_gbsqhpwj
                select HAOPAIWJXH,
                JUANQIHDJBXH,
                HAOPAIWJLXDM,
                ANJIANLXDM,
                ANJIANZT,
                PCTBJ,
                ZHIJIANBJ,
                ZHIJIANWCRQ,
                SHUJUTQBJ,
                SHUJUTQWCRQ,
                SHUJUZJBJ,
                SHUJUZJWCRQ,
                HAOPAISDSJ,
                HAOPAIZCBJ,
                BUMENDM,
                SHENCHAYDM,
                JUANQIH,
                GONGGAOLXDM,
                SHENQINGH,
                ZHULUXMZJBJ,
                GONGBAODZJZT,
                ZHULUXMTQBJ,
                GONGBAODTQBJ,
                ZHUFENLH,
                REGNAME,
                REGTIME,
                MODNAME,
                MODTIME,
                'rhy' || to_char(sysdate,'yyyymmdd'),
                GONGKAIGGR
                from gk_gbsqhpwj a8
                where a8.gonggaolxdm = '1601'
                and a8.shenqingh in (?)
            </sql>
            <sql>
                insert into backup_data_user.gg_zlx_zhu
                select SHENQINGH,
                ZHUANLIMC,
                ZHUANLIYWMC,
                ZHUANLILX,
                PCTBJ,
                SHENQINFSBJ,
                DAIYIBJ,
                SHENQINGR,
                FENANTJR,
                GUOBIE,
                SHENQINGRSL,
                FAMINGRENSL,
                LIANXIRBJ,
                WAIGUANCPLB,
                FENLEIHBBH,
                ZHUFENLH,
                DAILIBJ,
                FENANBJ,
                WEISHENGWBCBJ,
                XULIEBBJ,
                TIQIANGKBJ,
                SHISHENQQBJ,
                YOUXIANQQTS,
                ZUIXIAOYXQR,
                BUSANGSXYXKXQSMBJ,
                BAOMIQQBJ,
                QIANZHANGHGBJ,
                TUPIANHGBJ,
                FEIYONGJHBJ,
                PCTFJBJ,
                MUANBJ,
                ZAIXIANSQBJ,
                QUANLIYQXS,
                BAOMITXBJ,
                GUAQIBJ,
                ZANTINGBJ,
                ZHONGZHIBJ,
                SUODINGBJ,
                JIAKUAIBJ,
                SHISHENQQHGR,
                SHISHENSXR,
                TIQIANGKR,
                FAMINGGBR,
                GONGKAIGGR,
                ZHUANLIH,
                ANJIANYWZT,
                CHONGFUSQHBZ,
                CHONGFUSQQBZ,
                YOUXIAOBJ,
                REGNAME,
                REGTIME,
                MODNAME,
                MODTIME,
                SHOULIZKR,
                TONGYDFMCZBJ,
                XIANGSSJBJ,
                CHENGTCPBJ,
                XIANGSSJXS,
                CHENGTCPXS,
                YICZYBJ,
                XIANGWSQBJ,
                XIANGWSQSPBJ,
                FEIZHENGCSQYSBJ,
                'rhy' || to_char(sysdate,'yyyymmdd'),
                YXSCFS,
                ZJZDZSQSXR,
                SHENQINGRENFQZDXGQL
                from gg_zlx_zhu zhu
                where zhu.shenqingh in (?)
            </sql>
            <sql>
                insert into backup_data_user.gk_zlx_zhu
                select aa.*, 'rhy' || to_char(sysdate,'yyyymmdd')
                from gk_zlx_zhu aa
                where aa.gonggaolxdm = '1601'
                and aa.shenqingh in (?)
            </sql>
            <sql>
                insert into backup_data_user.gk_gbdfp
                select fp.GONGBAODFPXH,
                fp.JUANQIHDJBXH,
                fp.GONGGAOLXDM,
                fp.DAIMAHID,
                fp.DAIMAHWJID,
                fp.DAIMAHWJZT,
                fp.DAIMAHWJBBH,
                fp.JUANQIH,
                fp.SHENQINGH,
                fp.GONGBAODWJLXDM,
                fp.SHULIANG,
                fp.BUMENDM,
                fp.SHENCHAYDM,
                fp.ZHIJIANBJ,
                fp.CUOWUNR,
                fp.BEIZHU,
                fp.ANJIANZT,
                fp.REGNAME,
                fp.REGTIME,
                fp.MODNAME,
                fp.MODTIME,
                'rhy' || to_char(sysdate,'yyyymmdd'),
                fp.GONGKAIGGR,
                fp.DMHXGBJ
                from gk_gbdfp fp
                where fp.shenqingh in (?)
            </sql>
        </group>
        <group id="update">
            <sql>
                update fa_fmgk_gkajztjk jk
                set jk.gonggaozt = '20', jk.gonggaor = ''
                where jk.shenqingh in (?)
            </sql>
            <sql>
                insert into fa_fmgk_cbjyb_2
                select fa_fmgk_cbjyb_2_seq.nextval,
                jy.fa_fmgk_ggajztjk_id,
                jy.shenqingr,
                jy.shenqingh,
                zhu.pctbj,
                yxq.zaixianyxqr,
                zhu.tiqiangkr,
                zhu.zhufenlh,
                '20',--¹«¸æ×´Ì¬
                jy.yuguggr,
                jy.canshenhgfwr,
                jy.jinrujycsj,
                jy.songfenlsj,
                jy.fenleiwcsj,
                jy.fenleiwcbj,
                jy.zhuluxmtqbj,
                jy.zhuluxmtqwcsj,
                jy.gongbaodtqbj,
                jy.gongbaodtqwcsj,
                '1',
                jy.jiaoduijgfhsj,
                jy.regname,
                jy.regtime,
                jy.modname,
                jy.modtime
                from fa_fmgk_cbjyb_ls_2 jy
                left join gg_zlx_zhu zhu
                on zhu.shenqingh = jy.shenqingh
                left join (select max(gg_zlx_yxq.zaixiansqrq) as zaixianyxqr,
                gg_zlx_yxq.shenqingh
                from gg_zlx_yxq
                where gg_zlx_yxq.youxiaobj = '0'
                and gg_zlx_yxq.youxianqzt = '1'
                group by gg_zlx_yxq.shenqingh) yxq
                on yxq.shenqingh = jy.shenqingh
                where jy.shenqingh in (?)
            </sql>
            <sql>
                insert into fa_fmgk_jdb
                select fa_fmgk_jdb_seq.nextval,
                jd.shenqingh,
                '1',
                jd.jiaoduijlms,
                jd.jinrujdsj,
                jd.jiaoduikssj,
                jd.jiaoduijssj,
                jd.jiaoduiwcsj,
                jd.renlingr,
                jd.renlingrcsdm,
                jd.REGNAME,
                jd.REGTIME,
                jd.MODNAME,
                jd.MODTIME
                from fa_fmgk_jdb_ls jd
                where jd.shenqingh in (?)
            </sql>
            <sql>
                delete fa_fmgk_cbjyb_ls_2 jy where jy.shenqingh in (?)
            </sql>
            <sql>
                delete fa_fmgk_jdb_ls jd where jd.shenqingh in (?)
            </sql>
            <sql>
                delete fa_fmgk_gkqrb bf where bf.shenqingh in (?)
            </sql>
            <sql>
                insert into fa_fmgk_dggajb
                select FA_FMGK_DGGAJB_SEQ.nextval,
                a1.fa_fmgk_ggajztjk_id,
                a1.shenqingr,
                a1.shenqingh,
                a1.daoqir,
                a1.pctbj,
                a1.zuixiaoyxqr,
                a1.tiqiangksxr,
                a1.canshenhgfwr,
                a1.yuguggr,
                a1.gonggaozt,
                a1.zhufenleih,
                '1', --SHIFOUTGJY
                tzs.fawenr, --BANDENGFWR
                a1.jinrujycsj,
                a1.jiaoyanwcsj, --JIAODUIJLWCSJ
                null, --SONGFENLSJ
                a1.fenleiwcsj,
                a1.fenleiwcbj,
                '1', --WEIYONGWJXX
                '1', --WEIYONGFYXX
                null, --QITAYCXX
                a1.REGNAME,
                a1.REGTIME,
                a1.MODNAME,
                a1.MODTIME
                from fa_fmgk_gkajztjk a1
                left join (select max(gg_wj_tzsmsb.fawenr) as fawenr,
                gg_wj_tzsmsb.yewuztbh as shenqingh
                from gg_wj_tzsmsb
                where gg_wj_tzsmsb.tongzhiszt = '05'
                and gg_wj_tzsmsb.tongzhislx = '210304'
                group by gg_wj_tzsmsb.yewuztbh) tzs
                on tzs.shenqingh = a1.shenqingh
                where a1.shenqingh in (?)
            </sql>
            <sql>
                delete gg_zlx_gkgg t
                where t.gongkaigglx = '1601'
                --and t.gonggaor = '20170524'
                and t.shenqingh in (?)
            </sql>
            <sql>
                delete gk_gbsqhpwj hp
                where hp.gonggaolxdm = '1601'
                and hp.shenqingh in (?)
            </sql>
            <sql>
                update gg_zlx_zhu zhu
                set zhu.anjianywzt = 'S070102',zhu.faminggbr = ''
                where zhu.shenqingh in (?)
            </sql>
            <sql>
                delete gk_zlx_zhu dd where dd.gonggaolxdm = '1601' and dd.shenqingh in (?)
            </sql>
            <sql>
                update wf_currentstep c
                set c.step_id = '1901', c.status = '1901S00'
                where c.id in (select a.id
                from wf_currentstep a
                left join wf_wfentry b
                on b.id = a.entry_id
                where 1 = 1
                and b.name = '19'
                and b.state = '1'
                and b.main_id in (?))
            </sql>
            <sql>
                update gk_gbdfp fp
                set fp.anjianzt = '1601'
                where fp.gonggaolxdm = '1601'
                and fp.shenqingh in (?)
            </sql>
        </group>
    </groups>

    <sql id="allCount">
        select count(1) as count
        from fa_fmgk_gkqrb
        where fa_fmgk_gkqrb.gongkair = ?
    </sql>
    <sql id="successCount">
        select count(1) as count
        from fa_fmgk_gkqrb
        where fa_fmgk_gkqrb.gongkair = ?
        and fa_fmgk_gkqrb.shenqingh in
        (select gg_wj_tzsmsb.yewuztbh
        from gg_wj_tzsmsb
        where gg_wj_tzsmsb.tongzhislx in ('210305', '210308')
        and gg_wj_tzsmsb.tongzhiszt = '05'
        and gg_wj_tzsmsb.tongzhisscrq in (?))
    </sql>
    <sql id="lose">
        select zhu.shenqingh,
        zhu.faminggbr,
        cxdpz.chengxudmc,
        sczt.zhuangtaimc
        from gg_zlx_zhu zhu
        left join gg_sczt_scztpz sczt
        on sczt.zhuangtaibh = zhu.anjianywzt
        left join gg_sczt_sccxdpz cxdpz
        on cxdpz.chengxudbh = sczt.chengxudbh
        where substr(zhu.anjianywzt, '0', '5') = 'S1101'
        and zhu.shenqingh in
        (select fa_fmgk_gkqrb.shenqingh
        from fa_fmgk_gkqrb
        where fa_fmgk_gkqrb.gongkair = ?)
    </sql>
    <sql id="failedCount">
        select fa_fmgk_gkqrb.shenqingh
        from fa_fmgk_gkqrb
        where fa_fmgk_gkqrb.gongkair = ?
        and fa_fmgk_gkqrb.shenqingh not in
        (select gg_wj_tzsmsb.yewuztbh
        from gg_wj_tzsmsb
        where gg_wj_tzsmsb.tongzhislx in ('210305','210308')
        and gg_wj_tzsmsb.tongzhiszt = '05'
        and gg_wj_tzsmsb.tongzhisscrq in (?))
        and fa_fmgk_gkqrb.shenqingh not in
        (select zhu.shenqingh
        from gg_zlx_zhu zhu
        where substr(zhu.anjianywzt, '0', '5') = 'S1101'
        and zhu.shenqingh in
        (select fa_fmgk_gkqrb.shenqingh
        from fa_fmgk_gkqrb
        where fa_fmgk_gkqrb.gongkair = ?))
    </sql>
    <sql id="isExists">
        select t.an from t_pub_list@to_chubanshe t where t.an in (?)
    </sql>
    <sql id="wfTo1906">
        update wf_currentstep c
        set c.step_id = '1906', c.status = '1906S01'
        where c.id in (select a.id
        from wf_currentstep a
        left join wf_wfentry b
        on b.id = a.entry_id
        where 1 = 1
        and b.name = '19'
        and b.state = '1'
        and b.main_id in (?)
    </sql>
</sqls>